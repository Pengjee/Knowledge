# å½“å‰æ‰§è¡Œä¸Šä¸‹æ–‡this

## è°ƒç”¨ä½ç½®
è°ƒç”¨ä½ç½®æ˜¯æŒ‡å‡½æ•°åœ¨ä»£ç æ±‡æ€»çš„è¢«è°ƒç”¨çš„ä½ç½®ï¼ˆè€Œä¸æ˜¯ç”³æ˜ä½ç½®ï¼‰ã€‚å…¶ä¸­thisçš„è°ƒç”¨ä½ç½®ï¼Œæœ€é‡è¦çš„æ˜¯åˆ†æè°ƒç”¨æ ˆï¼Œå°±æ˜¯ä¸ºäº†è¾¾åˆ°å½“å‰æ‰§è¡Œä½ç½®æ‰€è°ƒç”¨çš„æ‰€æœ‰å‡½æ•°ã€‚
```js
function baz () {
    console.log('baz')
    bar()
}
function bar () {
    console.log('bar')
    foo();
}

function foo () {
    console.log('foo')
}

baz(); // baz -> bar -> foo
```
ä¸Šè¿°ä¾‹å­çš„è°ƒç”¨æ ˆé¡ºåºä¸ºbaz -> bar -> foo
## ç»‘å®šè§„åˆ™
å‡½æ•°çš„æ‰§è¡Œè¿‡ç¨‹ä¸­è°ƒç”¨ä½ç½®å†³å®šthisçš„ç»‘å®šå¯¹è±¡ã€‚
```md
è°ƒç”¨æ ˆ => è°ƒç”¨ä½ç½® => ç»‘å®šè§„åˆ™ => è§„åˆ™ä¼˜å…ˆçº§
```
### é»˜è®¤ç»‘å®šè§„åˆ™
å¸¸ç”¨çš„å‡½æ•°è°ƒç”¨ç±»å‹ï¼šç‹¬ç«‹å‡½æ•°è°ƒç”¨ã€‚å¯ä»¥æŠŠè¿™æ¡è§„åˆ™çœ‹ä½œæ˜¯æ— æ³•åº”ç”¨å…¶ä»–è§„åˆ™å¼çš„é»˜è®¤è§„åˆ™ã€‚
```js
function foo () {
    console.log(this.a)
}
var a = 2;
foo(); // 2
```
è¿™é‡Œçš„thisæŒ‡å‘windowï¼Œå®šä¹‰çš„aï¼Œæƒ³å½“äº`window.a`,ä½†å¦‚æœæˆ‘ä»¬ç”¨`let`ã€`const`è¿™é‡Œï¼Œè¿™é‡Œçš„this.aéƒ½ä¼šæ˜¯undefinedï¼Œè¿™æ˜¯
å› ä¸ºletã€constçš„ä½œç”¨åŸŸå¯¼è‡´çš„ã€‚
### éšå¼ç»‘å®š
å¦å¤–éœ€è¦è€ƒè™‘çš„æ˜¯è°ƒç”¨ä½ç½®æ˜¯å¦æœ‰ä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œæˆ–è€…è¯´æ˜¯å¦è¢«æŸä¸ªå¯¹è±¡æ‹¥æœ‰æˆ–è€…åŒ…å«ï¼Œè¿™ç§è¯´æ³•å¯èƒ½ä¼šé€ æˆä¸€äº›è¯¯å¯¼ã€‚
```js
function foo () {
    console.log(this.a)
}

const container = {
    a: 2,
    foo: foo
}
container.foo() // 2
```
é¦–å…ˆéœ€è¦æ³¨æ„çš„æ˜¯ foo çš„å£°æ˜æ–¹å¼ï¼ŒåŠå…¶ä¹‹åæ˜¯å¦‚ä½•è¢«å½“ä½œå¼•ç”¨å±æ€§æ·»åŠ åˆ° container ä¸­çš„ã€‚ä½†æ˜¯æ— è®ºæ˜¯ç›´æ¥åœ¨ container ä¸­å®šä¹‰è¿˜æ˜¯å…ˆå®šä¹‰å†æ·»åŠ ä¸ºå¼•ç”¨å±æ€§ï¼Œè¿™ä¸ªå‡½æ•°ä¸¥æ ¼æ¥è¯´éƒ½ä¸å±äº container å¯¹è±¡ã€‚

ç„¶è€Œï¼Œè°ƒç”¨ä½ç½®ä¼šä½¿ç”¨ container ä¸Šä¸‹æ–‡æ¥å¼•ç”¨å‡½æ•°ï¼Œå› æ­¤ä½ å¯ä»¥è¯´å‡½æ•°è¢«è°ƒç”¨æ—¶ container å¯¹è±¡ æ‹¥æœ‰ æˆ–è€… åŒ…å« å®ƒã€‚

æ— è®ºä½ å¦‚ä½•ç§°å‘¼è¿™ä¸ªæ¨¡å¼ï¼Œå½“ foo è¢«è°ƒç”¨æ—¶ï¼Œå®ƒçš„å‰é¢ç¡®å®åŠ ä¸Šäº†å¯¹ container çš„å¼•ç”¨ã€‚å½“å‡½æ•°å¼•ç”¨æœ‰ä¸Šä¸‹æ–‡æ—¶ï¼Œéšå¼ç»‘å®šè§„åˆ™ä¼šæŠŠå‡½æ•°è°ƒç”¨ä¸­çš„ this ç»‘å®šåˆ°è¿™ä¸ªä¸Šä¸‹æ–‡å¯¹è±¡ã€‚å› ä¸ºè°ƒç”¨ foo æ—¶ this è¢«ç»‘å®šåˆ° container ä¸Šï¼Œå› æ­¤ this.a å’Œ container.a æ˜¯ä¸€æ ·çš„ã€‚

ğŸ’¡**å¯¹è±¡å±æ€§å¼•ç”¨é“¾ä¸­åªæœ‰ä¸Šä¸€å±‚æˆ–æœ€åä¸€å±‚åœ¨è°ƒç”¨ä½ç½®ä¸­èµ·ä½œç”¨ã€‚**

```js
function foo () {
    console.log(this.a)
}
var obj2 = {
    a: 42,
    foo: foo
}
var obj1 = {
    a: 2,
    obj2: obj2
}
obj1.obj2.foo() // 42
```
#### éšå¼ä¸¢å¤±
ä¸€ä¸ªæœ€å¸¸è§çš„ this ç»‘å®šé—®é¢˜å°±æ˜¯è¢«éšå¼ç»‘å®šçš„å‡½æ•°ä¼šä¸¢å¤±ç»‘å®šå¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒä¼šåº”ç”¨é»˜è®¤ç»‘å®šï¼Œä»è€ŒæŠŠ this ç»‘å®šåˆ°å…¨å±€å¯¹è±¡æˆ–è€… undefined ä¸Šï¼ˆè¿™å–å†³äºæ˜¯å¦æ˜¯ä¸¥æ ¼æ¨¡å¼ï¼‰ã€‚
```js
function foo () {
    console.log(this.a)
}
const container = {
    a: 2,
    foo: foo
}
const bar = container.foo
const a = 'Hello'
bar() // hello
```
è™½ç„¶ bar æ˜¯ container.foo çš„ä¸€ä¸ªå¼•ç”¨ï¼Œä½†æ˜¯å®é™…ä¸Šï¼Œå®ƒå¼•ç”¨çš„æ˜¯ foo å‡½æ•°æœ¬èº«ï¼Œå› æ­¤æ­¤æ—¶çš„ bar å…¶å®æ˜¯ä¸€ä¸ªä¸å¸¦ä»»ä½•ä¿®é¥°çš„å‡½æ•°è°ƒç”¨ï¼Œå› æ­¤åº”ç”¨äº†é»˜è®¤ç»‘å®šã€‚
ä¸€ç§æ›´å¾®å¦™ã€æ›´å¸¸è§å¹¶ä¸”æ›´å‡ºä¹æ„æ–™çš„æƒ…å†µå‘ç”Ÿåœ¨ä¼ å…¥å›è°ƒå‡½æ•°æ—¶ã€‚
```js
function foo () {
    console.log(this.a)
}
function bar(fn) {
    fn();
}
var continaer = {
    a: 2,
    foo
}
var a = 'hello'
bar(container.foo) // hello
```
å‚æ•°ä¼ é€’å…¶å®æ˜¯ä¸€ç§éšå¼èµ‹å€¼ï¼Œå› æ­¤æˆ‘ä»¬ä¼ å…¥å‡½æ•°æ—¶ä¹Ÿä¼šè¢«éšå¼èµ‹å€¼ï¼Œæ‰€ä»¥ç»“æœå’Œä¸Šä¸ªç¤ºä¾‹ä¸€æ ·ã€‚
å¦‚æœæŠŠå‡½æ•°ä¼ å…¥è¯­è¨€å†…ç½®çš„å‡½æ•°è€Œä¸æ˜¯ä¼ å…¥ä½ è‡ªå·±å£°æ˜çš„å‡½æ•°ï¼Œç»“æœæ˜¯ä¸€æ ·çš„ï¼Œæ²¡æœ‰åŒºåˆ«ã€‚
```js
function foo() {
    console.log(this.a)
}
const container = {
    a: 2,
    foo
}
var a = 'hello'
setTimeout(container.foo, 100) // hello
```
å›è°ƒå‡½æ•°ä¸¢å¤± this ç»‘å®šæ˜¯éå¸¸å¸¸è§çš„ã€‚ é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ç§æƒ…å†µ this çš„è¡Œä¸ºä¼šå‡ºä¹æˆ‘ä»¬æ„æ–™ï¼šè°ƒç”¨å›è°ƒå‡½æ•°çš„å‡½æ•°å¯èƒ½ä¼šä¿®æ”¹ thisã€‚åœ¨ä¸€äº›æµè¡Œçš„ JavaScript åº“ä¸­äº‹ä»¶å¤„ç†å™¨ä¼šæŠŠå›è°ƒå‡½æ•°çš„
this å¼ºåˆ¶ç»‘å®šåˆ°è§¦å‘äº‹ä»¶çš„ DOM å…ƒç´ ä¸Šã€‚è¿™åœ¨ä¸€äº›æƒ…å†µä¸‹å¯èƒ½å¾ˆæœ‰ç”¨ï¼Œä½†æ˜¯æœ‰æ—¶å®ƒå¯èƒ½ä¼šè®©ä½ æ„Ÿåˆ°éå¸¸éƒé—·ã€‚é—æ†¾çš„æ˜¯ï¼Œè¿™äº›å·¥å…·é€šå¸¸æ— æ³•é€‰æ‹©æ˜¯å¦å¯ç”¨è¿™ä¸ªè¡Œä¸ºã€‚
æ— è®ºæ˜¯å“ªç§æƒ…å†µï¼Œthis çš„æ”¹å˜éƒ½æ˜¯æ„æƒ³ä¸åˆ°çš„ï¼Œå®é™…ä¸Šä½ æ— æ³•æ§åˆ¶å›è°ƒå‡½æ•°çš„æ‰§è¡Œæ–¹å¼ï¼Œå› æ­¤å°±æ²¡æœ‰åŠæ³•æ§åˆ¶è°ƒç”¨ä½ç½®ä»¥å¾—åˆ°æœŸæœ›çš„ç»‘å®šã€‚ä¹‹åæˆ‘ä»¬ä¼šä»‹ç»å¦‚ä½•é€šè¿‡å›ºå®š this æ¥ä¿®å¤è¿™ä¸ªé—®é¢˜ã€‚

### æ˜¾ç¤ºç»‘å®š
å°±åƒæˆ‘ä»¬åˆšæ‰çœ‹åˆ°çš„é‚£æ ·ï¼Œåœ¨åˆ†æéšå¼ç»‘å®šæ—¶ï¼Œæˆ‘ä»¬å¿…é¡»åœ¨ä¸€ä¸ªå¯¹è±¡å†…éƒ¨åŒ…å«ä¸€ä¸ªæŒ‡å‘å‡½æ•°çš„å±æ€§ï¼Œå¹¶é€šè¿‡è¿™ä¸ªå±æ€§é—´æ¥å¼•ç”¨å‡½æ•°ï¼Œä»è€ŒæŠŠ this éšå¼ç»‘å®šåˆ°è¯¥å¯¹è±¡ä¸Šã€‚
JavaScript æä¾›äº† applyã€call å’Œ bind æ–¹æ³•ï¼Œä¸ºåˆ›å»ºçš„æ‰€æœ‰å‡½æ•° ç»‘å®šå®¿ä¸»ç¯å¢ƒã€‚é€šè¿‡è¿™äº›æ–¹æ³•ç»‘å®šå‡½æ•°çš„ this æŒ‡å‘ç§°ä¸º æ˜¾å¼ç»‘å®šã€‚

#### ç¡¬ç»‘å®š
```js
function foo () {
    console.log(this.a)
}
const container = {
    a: 2
}
var bar = function () {
    foo.call(container)
}
bar(); // 2

setTimeout(bar, 100) // 2
// ç¡¬ç»‘å®šçš„ bar ä¸å¯èƒ½å†ä¿®æ”¹å®ƒçš„ this
bar.call(window) // 2
```
æˆ‘ä»¬åˆ›å»ºäº†å‡½æ•° barï¼Œå¹¶åœ¨å®ƒçš„å†…éƒ¨æ‰‹åŠ¨è°ƒç”¨äº† foo.call(container) ï¼Œå› æ­¤å¼ºåˆ¶æŠŠ foo çš„ this ç»‘å®šåˆ°äº† container ã€‚æ— è®ºä¹‹åå¦‚ä½•è°ƒç”¨å‡½æ•° barï¼Œ
å®ƒæ€»ä¼šæ‰‹åŠ¨åœ¨ container ä¸Šè°ƒç”¨ fooã€‚è¿™ç§ç»‘å®šæ˜¯ä¸€ç§æ˜¾å¼ï¼ˆæ‰‹åŠ¨ï¼‰çš„å¼ºåˆ¶ç»‘å®šï¼Œå› æ­¤æˆ‘ä»¬ç§°ä¹‹ä¸ºç¡¬ç»‘å®šã€‚

#### å†…ç½®å‡½æ•°
ç¬¬ä¸‰æ–¹åº“çš„è®¸å¤šå‡½æ•°ï¼Œä»¥åŠ JavaScript è¯­è¨€å’Œå®¿ä¸»ç¯å¢ƒä¸­è®¸å¤šæ–°çš„å†…ç½®å‡½æ•°ï¼Œéƒ½æä¾›äº†ä¸€ä¸ªå¯é€‰çš„å‚æ•°ï¼Œé€šå¸¸è¢«ç§°ä¸º ä¸Šä¸‹æ–‡ï¼ˆcontextï¼‰ï¼Œå…¶ä½œç”¨å’Œ bind ä¸€æ ·ï¼Œç¡®ä¿ä½ çš„å›è°ƒå‡½æ•°ä½¿ç”¨æŒ‡å®šçš„ this ã€‚
```js
function foo (item) {
    console.log(this.title, item)
}
const columns = {
    title: 'No'
}[(1,2,3)].forEach(foo, columns)
```

### æ„é€ è°ƒç”¨ç»‘å®š
ä½¿ç”¨ new æ¥è°ƒç”¨å‡½æ•°ï¼Œæˆ–è€…è¯´å‘ç”Ÿæ„é€ å‡½æ•°è°ƒç”¨æ—¶ï¼Œä¼šè‡ªåŠ¨æ‰§è¡Œä¸‹é¢çš„æ“ä½œã€‚

- åˆ›å»ºå…¨æ–°çš„ç©ºå¯¹è±¡
- å°†æ–°å¯¹è±¡çš„éšå¼åŸå‹å¯¹è±¡å…³è”æ„é€ å‡½æ•°çš„æ˜¾å¼åŸå‹å¯¹è±¡
- æ‰§è¡Œå¯¹è±¡ç±»çš„æ„é€ å‡½æ•°ï¼ŒåŒæ—¶è¯¥å®ä¾‹çš„å±æ€§å’Œæ–¹æ³•è¢« this æ‰€å¼•ç”¨ï¼Œå³ this æŒ‡å‘æ–°æ„é€ çš„å®ä¾‹
- å¦‚æœæ„é€ å‡½æ•°æ‰§è¡Œåæ²¡æœ‰è¿”å›å…¶ä»–å¯¹è±¡ï¼Œé‚£ä¹ˆ new è¡¨è¾¾å¼ä¸­çš„å‡½æ•°è°ƒç”¨ä¼šè‡ªåŠ¨è¿”å›è¿™ä¸ªæ–°å¯¹è±¡
```js
function objectFactory(constructor, ...rest) {
  // åˆ›å»ºç©ºå¯¹è±¡ï¼Œç©ºå¯¹è±¡å…³è”æ„é€ å‡½æ•°çš„åŸå‹å¯¹è±¡
  const instance = Object.create(constructor.prototype);

  // æ‰§è¡Œå¯¹è±¡ç±»çš„æ„é€ å‡½æ•°ï¼ŒåŒæ—¶è¯¥å®ä¾‹çš„å±æ€§å’Œæ–¹æ³•è¢« this æ‰€å¼•ç”¨ï¼Œå³ this æŒ‡å‘æ–°æ„é€ çš„å®ä¾‹
  const result = constructor.apply(instance, rest);

  // åˆ¤æ–­æ„é€ å‡½æ•°çš„è¿è¡Œç»“æœæ˜¯å¦å¯¹è±¡ç±»å‹
  if (result !== null && /^(object|function)$/.test(typeof result)) {
    return result;
  }

  return instance;
}
```
## ä¼˜å…ˆçº§
```
æ˜¾ç¤ºç»‘å®š > æ„é€ è°ƒç”¨ç»‘å®š > éšå¼ç»‘å®š
```

```vue
props={((data) => this.data = data}

this.$emit('', fn)
```