# 闭包

## 变量的作用域
在了解闭包之前，我们首先要搞懂什么变量的作用域。变量的作用域无非就两种：全局变量和局部变量。JS特殊之处就在于，函数内部可以直接读取全局的变量。但是外部却不能读取局部的变量。
```js
var n = 999
function f1 () {
    console.log(n)
}
fn() // 999

function f2 () {
    var n2 = 888
}
console.log(n2) // error 
```
那么有时候在实际开发中，又想从外部读取局部变量，这时候应该怎么办呢？
```js
function f1 () {
    var n = 999
    function f2 () {
        console.log(n) // 999
    }
}
```
我们可以直接通过返回函数的方式，把f2作为f1的返回值，就是可以在f1外部读取他的内部变量了
```js

function f1 () {
    var n = 999
    function f2 () {
        console.log(n)
    }
    return f2
}
var result = f1()
result() // 999
```

## 闭包的概念
上面的f2函数就是闭包。其实闭包就是能够读取其他函数内部变量的函数。

## 闭包的用途
闭包可以用在许多地方。它的最大用途有两个：
* 可以读取函数内部的变量
* 让这些变量值始终保持在内存中
始终保持在内存中这句话我们该如何理解呢？
```js
function f1 () {
    var n = 999
    nAdd = function () { n + 1 }
    function f2 () { console.log(n) }
    return f2
}
var result = f1()
result() // 999
nAdd() 
result() // 1000
```
上面的f2就是闭包函数，f2一共被调用了2次，第一次是999，第二次是1000。这证明了，函数f1中的局部变量n一直保存在内存中，并没有在f1调用后被清除。

f1是f2的父函数，而f2被赋予了一个全局变量，这导致f2始终在内存中，而f2的存在依赖于f1，因此f1也始终在内存中，不会调用结束后，被GC掉。

## 使用闭包的注意点
1. 由于闭包会使得函数中的变量都被保存在内存中，内存消耗很大，所以不能滥用闭包，否者会造成网页的性能问题，在IE中可能导致内存泄漏。
2. 闭包会在父函数外部，改变父函数的内部量的值。所以，如果你把父函数当作对象使用，把闭包当作公用的方法，把内部变量当作他的是有属性，这时需要注意不要随便改变父函数的内部变量值